# Experiment Pairing App (React + FastAPI)

Modernized web version of the Animal Pairing and Grouping desktop tool. Upload or paste animals, pick genotypes, name groups, distribute into balanced cohorts or pair by age, export to Excel, and demo everything with the built‑in example dataset.

## Project structure
- `src/` – React UI (Vite + TypeScript + Tailwind).
- `backend/` – FastAPI service with pairing/distribution logic.
- `example_data/animals.csv` – Bundled demo dataset (different from other apps).
- `tests/` – Playwright E2E covering the example workflow.
- `screenshots/example_run.png` – Generated by the E2E to document a passing run.
- Preview: open `screenshots/example_run.png` after running the E2E.

## Prerequisites
- Node 18+ and npm
- Python 3.10+

## Setup
```bash
# Install frontend deps (includes Playwright)
npm install

# Install backend deps
pip install -r backend/requirements.txt
```

## Run (dev)
```bash
# Start FastAPI (auto-reload) on :8001
npm run dev:back

# In another shell: start Vite dev server on :5173
npm run dev:front
```
Open http://localhost:5173 and toggle **Use Example Data** (or upload CSV/XLSX) to preload the sample animals.

## Data format & quick AI helper
- Required columns (CSV/XLSX): `Animal_ID, Genotype, Sex, Age` (see `example_data/animals.csv`).
- If your sheet has different headers/order, ask an AI to reshape it first. Handy links: [ChatGPT](https://chat.openai.com/), [Gemini](https://gemini.google.com/app), [Grok](https://grok.com/).
- Prompt to paste into any of them:
  - "Convert my table to CSV with headers: Animal_ID,Genotype,Sex,Age. Keep rows as-is, don’t invent data, output UTF-8 CSV text only."
- After conversion, save as `animals.csv` and upload or paste into the app. Screenshot helper: `screenshots/data-format-helper.svg`.

## Tests and screenshot
```bash
# Install browsers once
npx playwright install --with-deps chromium

# Start both servers and run E2E (saves screenshots/example_run.png)
npm run test:e2e
```

## API quick reference
- `POST /upload` – multipart file -> parsed animals + genotype list.
- `POST /distribute` – Body: animals[], num_groups, age_leeway, selected_genotypes?, group_names?, use_example?
- `POST /pair` – Body: animals[], age_leeway, selected_genotypes?, use_example?
- `POST /export-distribute` – Same as distribute, returns Excel workbook.
- `POST /export-pairs` – Same as pair, returns Excel workbook.
- `GET /health` – Liveness check.

All endpoints accept `use_example: true` to operate on `example_data/animals.csv`, ensuring the app runs without user files.
